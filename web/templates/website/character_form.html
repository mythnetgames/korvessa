{% extends "website/base.html" %}
{% block extra_head %}
  <link rel="stylesheet" type="text/css" href="{% static 'website/css/custom.css' %}">
{% endblock %}

<style>
body {
  background: #0a001a;
  color: #e0e0ff;
  font-family: 'Inter', 'Roboto', 'Arial', sans-serif;
}
.card, .card-header {
  background: linear-gradient(90deg, #1a0033 0%, #330066 100%);
  color: #ff00cc;
  border: 2px solid #00fff7;
  box-shadow: 0 0 24px #00fff744, 0 0 4px #ff00cc44;
}
.nav-link, a {
  color: #00fff7 !important;
  text-shadow: 0 0 8px #00fff7, 0 0 2px #ff00cc;
}
.nav-link:hover, a:hover {
  color: #ff00cc !important;
  text-shadow: 0 0 12px #ff00cc, 0 0 4px #00fff7;
}
</style>
{% block titleblock %}
Define Your Existence
{% endblock %}

{% block content %}

{% load addclass %}

  <div class="row">
    <div class="col">
      <div class="card">
        <div class="card-body">
          <h1 class="card-title">Define Your Existence</h1>
          <p class="text-muted">Step into Kowloon Walled City. Every person here must be someone. Become.</p>
          <hr />
          
            {% if form.errors %}
              {% for field in form %}
                {% for error in field.errors %}
                  <div class="alert alert-danger" role="alert">{{ error }}</div>
                {% endfor %}
              {% endfor %}
              {% for error in form.non_field_errors %}
                <div class="alert alert-danger" role="alert">{{ error }}</div>
              {% endfor %}
            {% endif %}
          
          <form method="post" action="?">
            {% csrf_token %}
  
            <div class="form-section mb-4">
              <h3>Identity</h3>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-field my-3">
                    {{ form.first_name.label_tag }}
                    {{ form.first_name | addclass:"form-control" }}
                    {% if form.first_name.help_text %}
                    <small class="form-text text-muted">{{ form.first_name.help_text|safe }}</small>
                    {% endif %}
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-field my-3">
                    {{ form.last_name.label_tag }}
                    {{ form.last_name | addclass:"form-control" }}
                    {% if form.last_name.help_text %}
                    <small class="form-text text-muted">{{ form.last_name.help_text|safe }}</small>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <div class="form-field my-3">
                {{ form.sex.label_tag }}
                {{ form.sex | addclass:"form-control" }}
                {% if form.sex.help_text %}
                <small class="form-text text-muted">{{ form.sex.help_text|safe }}</small>
                {% endif %}
              </div>
              
              <div class="form-field my-3">
                {{ form.desc.label_tag }}
                {{ form.desc | addclass:"form-control" }}
                {% if form.desc.help_text %}
                <small class="form-text text-muted">{{ form.desc.help_text|safe }}</small>
                {% endif %}
              </div>
            </div>
            
            <div class="form-section mb-4">
              <h3>Your Nature</h3>
              <p class="text-muted">Distribute 68 points across your stats. Every person in Kowloon has strengths and weaknesses.</p>
              <ul class="text-muted" style="list-style-type:none; padding-left:0;">
                <li><strong>Body (BODY):</strong> Your size, toughness, and ability to stay alive and conscious due to physical mass, structure, or other qualities. Important for determining how much damage you can take.</li>
                <li><strong>Reflexes (REF):</strong> Your response time and coordination, as used in aiming, throwing, juggling, etc. Affects your ability to hit things with ranged weapons.</li>
                <li><strong>Dexterity (DEX):</strong> Your overall physical competence, as it pertains to balancing, leaping, jumping, combat, and other athletic activities. Affects your ability to hit things with melee weapons and dodge attacks.</li>
                <li><strong>Technique (TECH):</strong> Your ability to manipulate tools or instruments. Covers the knack of using tools, hacking, and technical skills.</li>
                <li><strong>Smarts (SMRT):</strong> How generally bright you are. Includes cleverness, awareness, perception, and ability to learn.</li>
                <li><strong>Willpower (WILL):</strong> Your determination and ability to face danger and/or stress. Represents courage and ability to survive long-term privation. Important for determining how much damage you can take.</li>
                <li><strong>Edge (EDGE):</strong> Your ability to impress and influence people through character and charisma; how well you get along with others; how you interact in social situations.</li>
                <li><strong>Empathy (EMP):</strong> Your ability to relate to and care for others, and take others into consideration. Offsets the effects of cyberpsychosis.</li>
              </ul>
              <div id="stat-total-display" class="alert alert-info mb-3">
                <strong>Total Points:</strong> <span id="stat-total">68</span> / 68
                <span id="stat-status"></span>
              </div>
              {% for field in form %}
                {% if field.name in ['body','reflexes','dexterity','technique','smarts','willpower','edge','empathy'] %}
                <div class="form-field my-3">
                  {{ field.label_tag }}
                  {{ field | addclass:"form-control stat-field" }}
                  {% if field.help_text %}
                  <small class="form-text text-muted">{{ field.help_text|safe }}</small>
                  {% endif %}
                </div>
                {% endif %}
              {% endfor %}
            </div>
            
            <hr />
            <div class="form-group">
              <input class="form-control btn btn-outline-secondary" type="submit" value="Enter the City" />
              <input type="hidden" name="next" value="{{ next }}" />
            </div>
          </form>
          
        </div>
      </div>
    </div>
  </div>
{% include "website/footer.html" %}

<script>
// GRIM Stat Point Calculator
document.addEventListener('DOMContentLoaded', function() {
  const grimStats = document.querySelectorAll('.grim-stat');
  const totalDisplay = document.getElementById('grim-total');
  const statusDisplay = document.getElementById('grim-status');
  const totalContainer = document.getElementById('grim-total-display');
  const submitButton = document.querySelector('input[type="submit"]');
  
  function updateTotal() {
    let total = 0;
    console.log('=== Calculating GRIM Total ===');
    console.log('Found', grimStats.length, 'stat inputs');
    grimStats.forEach(stat => {
      const value = parseInt(stat.value, 10) || 0;
      console.log(stat.name, '=', stat.value, '-> parsed as', value);
      total = total + value;
    });
    console.log('Final total:', total);
    
    totalDisplay.textContent = total;
    
    if (total === 300) {
      totalContainer.className = 'alert alert-success mb-3';
      statusDisplay.innerHTML = '<span class="ml-2">✓ Valid</span>';
      submitButton.disabled = false;
    } else if (total > 300) {
      totalContainer.className = 'alert alert-danger mb-3';
      statusDisplay.innerHTML = '<span class="ml-2">✗ Over by ' + (total - 300) + '</span>';
      submitButton.disabled = true;
    } else {
      totalContainer.className = 'alert alert-warning mb-3';
      statusDisplay.innerHTML = '<span class="ml-2">⚠ Under by ' + (300 - total) + '</span>';
      submitButton.disabled = true;
    }
  }
  
  grimStats.forEach(stat => {
    stat.addEventListener('input', updateTotal);
    stat.addEventListener('change', updateTotal);
  });
  
  // Initial calculation
  updateTotal();
});
</script>

{% endblock %}
